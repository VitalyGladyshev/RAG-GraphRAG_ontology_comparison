# Генератор оценочного датасета

Инструмент командной строки для создания оценочных наборов данных на основе файлов axiom с использованием больших языковых моделей (LLM). Утилита обрабатывает аксиомы в формате Attempto Controlled English (ACE) и формирует оценочный датасет для систем на базе RAG.

## Возможности

- **Обработка аксиом**: загрузка и поиск аксиом по идентификатору объекта;
- **Интеграция с LLM**: генерация эталонных ответов с помощью различных провайдеров LLM;
- **Создание наборов данных**: формирование оценочных наборов данных в нескольких форматах (CSV, Parquet, JSON);
- **Валидация**: проверка качества и целостности набора данных;
- **Предварительный просмотр**: отображение содержимого набора данных в консольном формате;

## Установка

```bash
# Клонировать репозиторий
git clone https://github.com/yourusername/axiom-dataset-generator.git
cd axiom-dataset-generator

# Создать виртуальное окружение
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate    # Windows

# Установить зависимости
pip install -r requirements.txt

# Установить пакет в режиме разработки
pip install -e .
```

## Использование

### Основные команды

```bash
# Генерация датасета (наиболее частый сценарий использования)
python -m src.main generate \
  --axioms-file ./s1-c5-214.txt \
  --api-key "your-api-key-here" \
  --output-dir ./datasets \
  --prefix "evaluation_cases"

# Предварительный просмотр сгенерированного датасета
python -m src.main preview \
  --dataset-file ./datasets/evaluation_cases_20260109_222314.json \
  --num-preview 3

# Валидация качества датасета
python -m src.main validate \
  --dataset-file ./datasets/evaluation_cases_20260109_222314.json

# Тестирование поиска аксиом
python -m src.main test-search \
  --axioms-file ./s1-c5-214.txt \
  --object-ids I1 I17 I101 I198
```

### Расширенные опции генерации

```bash
python -m src.main generate \
  --axioms-file ./s1-c5-214.txt \
  --api-key "sk-or-vv-your-key-here" \
  --model "google/gemma-3-27b-it" \
  --api-base "https://api.vsegpt.ru/v1" \
  --temperature 0.1 \
  --max-tokens 2048 \
  --output-dir ./custom_datasets \
  --prefix "my_evaluation" \
  --start-id 1 \
  --end-id 50 \
  --query-template "Опишите все свойства и отношения объекта {object_id} подробно." \
  --batch-size 5 \
  --no-auto-detect \
  --verbose
```

## Команды

### Команда `generate`

Генерация датасета для оценки из аксиом.

**Обязательные аргументы:**
- `--axioms-file`: Путь к файлу с аксиомами
- `--api-key`: API ключ для сервиса LLM

**Необязательные аргументы:**
- `--output-dir`: Директория для вывода (по умолчанию: `datasets`)
- `--prefix`: Префикс для имен файлов (по умолчанию: `rag_test_cases`)
- `--auto-detect`: Автоопределение объектов из аксиом (по умолчанию: включено)
- `--start-id`: Начальный ID объекта при отключенном автоопределении (по умолчанию: 1)
- `--end-id`: Конечный ID объекта при отключенном автоопределении (по умолчанию: 199)
- `--query-template`: Шаблон запроса с плейсхолдером `{object_id}`
- `--batch-size`: Сохранять промежуточные результаты каждые N случаев (по умолчанию: 10)
- `--model`: Название модели LLM (по умолчанию: `google/gemma-3-27b-it`)
- `--api-base`: Базовый URL API (по умолчанию: `https://api.vsegpt.ru/v1`)
- `--temperature`: Температура генерации (по умолчанию: 0.1)
- `--max-tokens`: Максимальное количество токенов для генерации (по умолчанию: 2048)
- `--quiet`: Подавить вывод прогресса
- `--verbose`: Включить детальное логирование

### Команда `validate`

Валидация качества и целостности датасета.

**Обязательные аргументы:**
- `--dataset-file`: Файл датасета для валидации

### Команда `preview`

Предварительный просмотр содержимого датасета в консольном формате.

**Обязательные аргументы:**
- `--dataset-file`: Файл датасета для просмотра

**Необязательные аргументы:**
- `--num-preview`: Количество случаев для просмотра (по умолчанию: 5)

### Команда `test-search`

Тестирование функциональности поиска аксиом для конкретных объектов.

**Обязательные аргументы:**
- `--axioms-file`: Путь к файлу с аксиомами
- `--object-ids`: ID объектов для тестирования (разделяются пробелами)

## Модули

Утилита следует модульной класс-ориентированной архитектуре:

- **`AxiomsProcessor`**: Обработка загрузки, поиска и извлечения объектов из аксиом
- **`UniversalLLMClient`**: Управление взаимодействием с LLM через OpenAI-совместимый API
- **`DatasetGenerator`**: Создание датасетов для оценки с использованием аксиом и LLM
- **`DatasetValidator`**: Валидация целостности и качества датасета
- **`DatasetVisualizer`**: Предоставление возможностей для просмотра и анализа датасета

Такое разделение следует принципам SOLID и делает код тестируемым, переиспользуемым и легко расширяемым.

## Форматы вывода

Генератор создает датасеты в трех форматах:

1. **CSV**: Читаемый человеком формат для анализа
2. **Parquet**: Сжатый формат для эффективного хранения и обработки
3. **JSON**: Полный формат со всеми метаданными

## Тестирование

Проект включает модульные тесты для основных компонентов:

```bash
# Запуск тестов
python -m unittest discover -s tests
```
